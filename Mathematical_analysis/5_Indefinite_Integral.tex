% !TEX root = main.tex

\section{不定积分}
\label{sec:indefinite_integration}
\subsection{三种基本积分方法}
\begin{enumerate}
	\item 凑微分法
	\item 第二换元法（记得换元时$\diff x$也要换）
	\item 分部积分法
	\begin{itemize}
		\item 先写成$\displaystyle\int u(x)\diff v(x)$的形式，然后直接交换$u(x),v(x)$即可
		\item 选取$u(x)$顺序：\textbf{对反幂三指}，如求$\displaystyle\int x^2\cos x\diff x$，取$u(x)=x^2$，化为$\displaystyle\int x^2\diff\sin x$
	\end{itemize}
\end{enumerate}

\subsection{常见公式}
比较基础的公式在此不再列举，以下积分是在题目中比较常见，均需熟练掌握推导
\begin{enumerate}
\item 对数
\[\int \ln x\diff x=x(\ln x-1)+C\qquad\mbox{凑微分法}\]
\item （反）三角函数
\[\int \tan x\diff x=-ln|\cos x|+C\qquad\mbox{凑微分法,小心}-\mbox{号}\]
\[\int \cot x\diff x=ln|\sin x|+C\qquad\mbox{分部积分}\]
\[\int \sec x\diff x=ln|\sec x+\tan x|+C\qquad\mbox{乘}\frac{\sec x+\tan x}{\sec x+\tan x}\]
\[\int \csc x\diff x=ln|\csc x-\cot x|+C\qquad\mbox{乘}\frac{\csc x+\cot x}{\csc x+\cot x}\]
\[\int \arcsin x\diff x=x\arcsin x+\sqrt{1-x^2}+C\qquad\mbox{分部积分}\]
\[\int \sec^3 x \diff x=\frac{1}{2} (\tan x \sec x+\ln |\tan x+\sec x|)+C\qquad\mbox{分部积分}\]
\item 根式/分式
\[\int \frac{\diff x}{a^2+x^2}=\frac{1}{a} \arctan\frac{x}{a}+C\qquad\mbox{分子分母除以}a^2\]
\[\int \frac{\diff x}{\pm(x^2-a^2)}=\pm\frac{1}{2a} \ln\left|\frac{x-a}{x+a}\right|+C\qquad\mbox{裂项可得}\]
\[\int \frac{\diff x}{\sqrt{a^2-x^2}}=\arcsin\frac{x}{a}+C\qquad\mbox{将}a^2\mbox{提出来}\]
\[\int \frac{\diff x}{\sqrt{x^2\pm a^2}}=\ln|x+\sqrt{x^2\pm a^2}|+C\qquad\mbox{三角换元，注意会有$1/a$，但为常数}\]
\[\int \sqrt{a^2-x^2}\diff x=\frac{a^2}{2}\arcsin\frac{x}{a}+\frac{x}{2}\sqrt{a^2-x^2}+C\qquad\mbox{分子有理化$+$分部积分}\]
\[\int \sqrt{x^2\pm a^2}\diff x=\pm\frac{a^2}{2} \ln\Big|x+\sqrt{x^2\pm a^2}\Big|+\frac{x}{2}\sqrt{x^2\pm a^2}+C\qquad\mbox{分子有理化$+$分部积分}\]
\end{enumerate}
注意：
\begin{enumerate}
\item 不要忘记加$C$
\item 对$\displaystyle \frac{1}{x}$求积分出来是$\ln |x|+C$，有绝对值
%\item $\displaystyle f(x)f'(x),\frac{f(x)}{f'(x)}$均由链式法则得来
\end{enumerate}

\subsection{不同类型积分的常见思路}
\begin{enumerate}
	\item 有理分式
	\begin{itemize}
		\item 假分式先除下来变为真分式，然后用部分分式
		\item 若非纯有理分式（如各种基本初等函数的组合，见例\ref{egfrac2}），或分母次数太高（见例\ref{egfrac3}），则将分子配凑成分母形式或分母导数形式以便分拆相加（这两种方式都十分常用）
		\item 分母一定要先分解为一次乘二次的形式（虚数的情况请看例\ref{egfrac1}），也即分解为
			\[\prod_{i=1}^k(x-a_i)^{j_i}\prod_{i=1}^s(x^2+p_ix+q_i)^{l_i}\]
			结合分子，也就有部分分式的两种基本形式
			\[\frac{A}{(x-a)^n},\quad\frac{Bx+C}{(x^2+px+q)^n}\]
		\item 前者直接积，后者配平方（见例\ref{egfrac4}）
		\item 小技巧：通过倒代换$\displaystyle x=\frac{1}{t}$降低分母次数（见例\ref{egsqrt1}法二），有$\displaystyle\frac{1}{x},\frac{1}{x^2}$等部分的可以考虑，如$\displaystyle\int\frac{\diff x}{x^{100}+x}$也可使用
	\end{itemize}
	\begin{example}
		\label{egfrac1}
		$\displaystyle\int\frac{\diff x}{1+x^4}$
	\end{example}
	\begin{analysis}
		先对分母进行分解，$1+x^4=(x+\sqrt{i})(x-\sqrt{i})(x+\sqrt{-i})(x-\sqrt{-i})$\\
		之所以是这$4$个根，是因为我们知道$1+(x^2)^2=0$的解为$x^2=\pm i$，故上式也就理所当然了\footnote{实际上这样写是不严谨的，具体有关复数根的细节等之后有空再讲吧}\\
		由于复根不好看，所以合并一下就变成$1+x^4=(x^2+\sqrt{2}x+1)(x^2-\sqrt{2}x+1)$，然后就可以用部分分式那一套去算了
	\end{analysis}
	\begin{example}
		\label{egfrac2}
		\begin{equation*}
		\begin{aligned}
			\int \frac{xe^x}{(x+1)^2}\diff x &= \int \frac{(x+1-1)e^x}{(x+1)^2}\diff x\qquad\mbox{分子配凑为分母形式}\\
			&= \int \frac{e^x}{x+1}\diff x - \int \frac{e^x}{(x+1)^2}\diff x\qquad\mbox{分拆}\\
			&= \frac{e^x}{x+1}-\int e^x\diff\frac{1}{x+1} - \int \frac{e^x}{(x+1)^2}\diff x\qquad\mbox{分部积分}\\
			&= \frac{e^x}{x+1}+\int \frac{e^x}{(x+1)^2}\diff x - \int \frac{e^x}{(x+1)^2}\diff x\qquad\mbox{刚好消掉}\\
			&= \frac{e^x}{x+1}+C
		\end{aligned}
		\end{equation*}
	\end{example}
	\begin{example}
		\label{egfrac3}
		\begin{equation*}
		\begin{aligned}
			\int\frac{x^2+2}{(x+1)^3}\diff x &= \int \frac{(x+1)^2-2(x+1)+3}{(x+1)^3}\diff x\qquad\mbox{分子几次就配几次式}\\
			&= \int \frac{\diff(x+1)}{x+1} - 2\int \frac{\diff(x+1)}{(x+1)^2} + 3\int \frac{\diff(x+1)}{(x+1)^3}\qquad\mbox{分拆}\\
			&= \ln|x+1|+\frac{2}{x+1}-\frac{3}{2}\frac{1}{(x+1)^2}+C
		\end{aligned}
		\end{equation*}
	\end{example}
	\begin{example}
		\label{egfrac4}
		\begin{equation*}
		\begin{aligned}
			\int\frac{x+1}{x^2+x+1}\diff x &= \frac{1}{2}\int \frac{(2x+1)+1}{x^2+x+1}\diff x\qquad\mbox{分子配凑为分母导数形式}\\
			&= \frac{1}{2}\int \frac{2x+1}{x^2+x+1} - \frac{1}{2}\int \frac{\diff(x+1/2)}{(x+1/2)^2+(\sqrt{3}/{2})^2}\qquad\mbox{分拆}\\
			&= \frac{1}{2}\ln|x^2+x+1|+\frac{1}{\sqrt{3}}\arctan\frac{2x+1}{\sqrt{3}}+C
		\end{aligned}
		\end{equation*}
	\end{example}
	\item 三角函数
	\begin{itemize}
		\item 可以三角恒等变换的要先变换，熟悉半角、倍角（降幂升角）、积化和差和差化积（不同角）、辅助角（相同角）等等的使用，对以下公式的正用反用要相当敏感，懂得灵活转换
		\begin{itemize}
			\item[*] $\displaystyle 1+\sin kx=\left(\sin\frac{kx}{2}+\cos\frac{kx}{2}\right)^2$，$1+\cos x=2\cos^2 x$
			\item[*] $\tan^2 x+1=\sec^2 x$，$(\tan x)'=\sec^2 x$，$(\sec x)'=\tan x\sec x$
		\end{itemize}
		\item 第一步最终目的是结合凑微分法努力化为同名函数（见例\ref{eg1}），或是有一定关系的式子（见例\ref{eg2}）
		\item 没有好方法，最后才采用万能公式（见例\ref{eg3}），别一上来就太暴力
		\item 最终很大几率会化为分式型积分
		\item 小技巧1：通过分子分母同乘的方法强行凑平方，如求$\sec x$积分，分子分母同乘$\cos x$
		\item 小技巧2：配对偶式，如$\displaystyle\int\frac{\sin x}{a\sin x+b\cos x}\diff x$
	\end{itemize}
	\begin{example}
		\label{eg1}
		\begin{equation*}
		\begin{aligned}
			\int \frac{\sin^3 x}{1+\cos^2 x}\diff x &= \int \frac{(1-\cos^2)\sin x}{1+\cos^2 x}\diff x\qquad\mbox{恒等变换}\\
			&= \int \frac{1-\cos^2 x}{1+\cos^2 x}\diff\cos x\qquad\mbox{凑微分，化同名}\\
			&\xlongequal{t=\cos x} \int \left(-1+\frac{2}{1+t^2}\right)\diff t\qquad\mbox{化为分式型}\\
			&= \cdots
		\end{aligned}
		\end{equation*}
	\end{example}
	\begin{example}
		\label{eg2}
		\begin{equation*}
		\begin{aligned}
			\int \frac{\diff x}{\sin^2 x\cos x} &= \int \sec x\diff\cot x\qquad\mbox{凑微分，熟悉偏门三角函导数}\\
			&= \sec x\cot x-\int\cot x\sec x\tan x\diff x\qquad\mbox{分部积分会将}\cot x\mbox{消去，故才有上一步的凑微分}\\
			&= \sec x\cot x-\int\sec x\diff x\\
			&= \sec x\cot x-\ln|\sec x+\tan x|+C
		\end{aligned}
		\end{equation*}
		注；本题也可分子分母同乘$\cos x$，化为分式解决，但较为麻烦
	\end{example}
	\begin{example}
		\label{eg3}
		\begin{equation*}
		\begin{aligned}
			\int \frac{\diff x}{2+\sin^2 x} &= \int \frac{\diff x}{2+\frac{1-\cos 2x}{2}}\qquad\mbox{降幂升角}\\
			&= 2\int \frac{\diff x}{5-\cos 2x}\\
			&= 2\int \frac{1+\tan^2 x}{5(1+\tan^2 x)-(1-\tan^2 x)}\diff x\qquad\mbox{万能公式}\\
			&\xlongequal{t=\tan x} 2\int \frac{1+t^2}{6t^2+4}\frac{1}{1+t^2}\diff t\qquad\mbox{换元，记得微分也要变}\\
			&= \int \frac{\diff t}{3t^2+2}\qquad\mbox{化为分式型}\\
			&= \cdots
		\end{aligned}
		\end{equation*}
		注；本题分母若变为$3-\cos^2 x$没什么作用，故应先考虑倍角公式，实现降幂
	\end{example}
	\begin{example}
		\label{eg4}
		三角函数相乘怎么玩，请见此题分解
		\begin{equation*}
		\begin{aligned}
			\int \tan(x+a)\tan(x+b)\diff x&= \int \frac{\sin(x+a)\sin(x+b)}{\cos(x+a)\cos(x+b)}\diff x\qquad\mbox{切化弦}\\
			&= \int \left(\frac{\sin(x+a)\sin(x+b)+\cos(x+a)\cos(x+b)}{\cos(x+a)\cos(x+b)}-1\right)\diff x\\
			&\qquad\mbox{加一项减一项，目标消}x\\
			&= \int \left(\frac{\cos(a-b)}{\cos(x+a)\cos(x+b)}-1\right)\diff x\qquad\mbox{用和差角公式进行合并}\\
			&= -x+\cos(a-b)\int \frac{\sin((a+x)-(b+x))\diff x}{\sin(a-b)\cos(x+a)\cos(x+b)}\qquad\mbox{同乘}\sin(a-b)\\
			&= -x+\cot(a-b)\int \frac{\sin(x+a)\cos(x+b)-\cos(x+a)\sin(x+b)\diff x}{\cos(x+a)\cos(x+b)}\qquad\mbox{拆开}\\
			&= -x+\cot(a-b)-\int (\tan(x+a)-\tan(x+b))\diff x\\
			&= -x+\cot(a-b)-\ln\left|\frac{\cos(x+a)}{\cos(x+b)}\right|+C
		\end{aligned}
		\end{equation*}
		注：同乘的部分我们采用了$\sin(a-b)$而不是$\cos(a-b)$，因$\sin (x+y)$拆分后有交叉的$\sin x\cos y$项，可以与分母相消. 同样的方法可计算$\displaystyle\int\frac{\diff x}{\sin(x+a)\sin(x+b)}$，$\displaystyle\int\frac{\diff x}{\cos(x+a)\cos(x+b)}$等等，留给读者做练习
	\end{example}
	\item 根式
	\begin{itemize}
		\item 对于二次根式，采用整块换元（见例\ref{egsqrt1}法一）；也可根式内配方后三角代换或直接用常用公式（见例\ref{egsqrt1}法二）
		\begin{itemize}
			\item[*] 整块换元的形式
			\[\int R\left(x,\sqrt[n]{\frac{ax+b}{cx+d}}\right)\diff x,\mbox{其中}n>1,ad-bc\ne 0\]
			\item[*] 配方的形式
			\[\int R\left(x,\sqrt{ax^2+bx+c}\right)\diff x,\mbox{其中}a>0,b^2-4ac\ne 0,\mbox{或}a<0,b^2-4ac>0\]
		\end{itemize}
		\item 对于简单高次根式的加减，用最小公倍数法消根号，如$\sqrt{x}$与$\sqrt[3]{x}$同时存在，令$x=t^{\,lcm(2,3)}=t^6$
		\item 对于复杂高次根式，凑微分不断换元使根式内多项式次数降至一次，再进行整块换元转化成有理分式（见例\ref{egsqrt3}）
		\item 当然以上的讨论都是针对化简至没法再化简的根式而言，如$\displaystyle\frac{x}{\sqrt[4]{x^3(1-x)}}$就不算最简根式
		\item 分式与根式结合，先用分式的配凑拆分等化简（见例\ref{egsqrt2}）
	\end{itemize}
	\begin{example}
		\label{egsqrt1}
		法一：
		\begin{equation*}
		\begin{aligned}
			\int\sqrt{\frac{1-x}{1+x}}\frac{\diff x}{x^2} &\xlongequal{t^2=\frac{1-x}{1+x}} \int t\frac{-4t}{(1+t^2)^2}\frac{(1+t^2)^2}{(1-t^2)^2}\diff t\qquad x=\frac{1-t^2}{1+t^2},\mbox{直接将整块根式换掉}\\
			&= -4\int \frac{t^2}{(1-t^2)^2}dt\\
			&= -4(\frac{1}{2})\int t\diff\frac{1}{1-t^2}\qquad\mbox{很有技巧的凑微分}\\
			&= -2(\frac{t}{1-t^2}-\int\frac{\diff t}{1-t^2})\qquad\mbox{分部积分}\\
			&= -2\frac{t}{1-t^2}-\ln\left|\frac{x-1}{x+1}\right|+C\\
			&= -\frac{\sqrt{(1-x) (1+x)}}{x}-\ln \left|\frac{\sqrt{1+x}-\sqrt{1-x}}{\sqrt{1-x}+\sqrt{1+x}}\right|+C\qquad\mbox{将}t\mbox{回代}
		\end{aligned}
		\end{equation*}
		法二：
		\begin{equation*}
		\begin{aligned}
			\int\sqrt{\frac{1-x}{1+x}}\frac{\diff x}{x^2} &=\int\frac{1-x}{\sqrt{1-x^2}}\frac{\diff x}{x^2}\qquad\mbox{分子有理化}\\
			&= \int\frac{\diff x}{x^2\sqrt{1-x^2}}-\int\frac{\diff x}{x\sqrt{1-x^2}}\qquad\mbox{分拆}\\
			&\xlongequal{x=\frac{1}{t}} -\frac{1}{2}\int\frac{\diff t^2}{\sqrt{t^2-1}}+\int\frac{\diff t}{\sqrt{t^2-1}}\qquad\mbox{倒代换}\\
			&= -\sqrt{t^2-1}+\ln|t+\sqrt{t^2-1}|+C\\
			&= -\sqrt{\frac{1}{x^2}-1}+\ln\left|\frac{1}{x}+\sqrt{\frac{1}{x^2}-1}\right|+C\qquad\mbox{将}t\mbox{回代}
		\end{aligned}
		\end{equation*}
	\end{example}
	\begin{example}
		\label{egsqrt2}
		\begin{equation*}
		\begin{aligned}
			\int \frac{\diff x}{(x^2+a^2)^{\frac{3}{2}}}&= \frac{1}{a^2}\int\frac{x^2+a^2-x^2}{(x^2+a^2)^{\frac{3}{2}}}\diff x\qquad\mbox{分子配凑分母形式，小技巧：留下常数}a^2\\
			&= \frac{1}{a^2}\int\frac{\diff x}{(x^2+a^2)^{\frac{1}{2}}}+\frac{1}{a^2}\int x\diff\frac{1}{(x^2+a^2)^{\frac{1}{2}}}\\
			&\quad\mbox{技巧是直接把后面那一项放入微分中，求导看差什么再补}\\%改了符号
			&= \frac{1}{a^2}\frac{x}{(x^2+a^2)^{\frac{1}{2}}}+C\qquad\mbox{分部积分，刚好消去}
		\end{aligned}
		\end{equation*}
	\end{example}
	\begin{example}
		\label{egsqrt3}
		\begin{equation*}
		\begin{aligned}
			\int \frac{\diff x}{x\sqrt[4]{1+x^4}}&= \int\frac{x\diff x}{x^2\sqrt[4]{1+x^4}}\qquad\mbox{分子分母同乘}x\mbox{凑微分}\\
			&\xlongequal{t=x^2} \frac{1}{2}\int\frac{\diff t}{t\sqrt[4]{1+t^2}}\qquad\mbox{换元降次}\\
			&= \frac{1}{2}\int\frac{t\diff t}{t^2\sqrt[4]{1+t^2}}\qquad\mbox{分子分母同乘}t\mbox{凑微分，与第一步相同}\\
			&\xlongequal{u=t^2} \frac{1}{4}\int\frac{\diff u}{u\sqrt[4]{1+u}}\qquad\mbox{换元降次}\\
			&\xlongequal{v^4=1+u} \int\frac{v^2\diff v}{v^4-1}\qquad\mbox{整块换元}\\
			&= \frac{1}{2}\int\frac{\diff v}{v^2+1}+\frac{1}{4}\int\frac{\diff v}{v-1}-\frac{1}{4}\int\frac{\diff v}{v+1}\qquad\mbox{部分分式}\\
			&= \frac{1}{2}\arctan{\sqrt[4]{1+x^4}}+\frac{1}{4}\ln\left|\frac{\sqrt[4]{1+x^4}-1}{\sqrt[4]{1+x^4}+1}\right|+C\qquad\mbox{回代}
		\end{aligned}
		\end{equation*}
		这题如果用倒代换$\displaystyle t=\frac{1}{x}$变成求$\displaystyle -\int\frac{\diff t}{\sqrt[4]{1+t^4}}$反而不这么好做，因为这题与之前的题刚好相反，得先升幂，凑微分后才可以进行降幂；否则直接降幂会把根式前的$x$消掉，次数反而不齐了，请读者自行体会这其中的区别. 
	\end{example}
\end{enumerate}

\subsection{例题}
\begin{enumerate}
	\item $\displaystyle\int \frac{3x^2}{1+x^2}\diff x$
	\item $\displaystyle\int \tan^3 x\diff x\qquad\qquad\qquad$ 凑微分
	\item $\displaystyle\int \frac{\diff x}{A\sin^2 x+B\cos^2 x}\diff x\qquad\qquad\qquad$ 配对偶
	\item $\displaystyle\int \cos^5\diff x\qquad\qquad\qquad$ 不用分部积分
	\item $\displaystyle\int \sin 3x \cos 2x\diff x\qquad\qquad\qquad$ 积化和差
	\item $\displaystyle\int \frac{\sec x}{(1+\sec x)^2}\diff x\qquad\qquad\qquad$ 恒等变换
	\item $I_n=\displaystyle\int \tan^n x\diff x\qquad\qquad\qquad$ 用$I_{n-2}$递推
	\item $\displaystyle\int \frac{\diff x}{x\sqrt{x^2+2x+2}}\qquad\qquad\qquad$ 倒代换
	\item $\displaystyle\int x\sqrt{x^2-2x+2}\qquad\qquad\qquad$ 配方配凑
	\item $\displaystyle\int \frac{x^2}{\sqrt{1+x-x^2}}\diff x\qquad\qquad\qquad$ 配分母形式
\end{enumerate}