% !TEX root = main.tex

\newpage
\appendix
\section{线性代数基础}
\subsection{非奇异矩阵}
关于可逆矩阵的性质如下：
\begin{itemize}
    \item 可逆矩阵即非奇异(non-singular)矩阵
    \item 行列式为$0$
    \item 满秩
\end{itemize}

\subsection{内积与范数}
\begin{definition}[标准内积]
    标准向量内积
    \[\forall \vx,\vy\in\rn:\;\lrang{\vx,\vy}=\vx^\T\vy=\sum_{i=1}^n x_iy_i\]
    标准矩阵内积
    \[\forall X,Y\in\rr^{m\times n}=\optr(X^\T Y)=\sum_{i=1}^m\sum_{j=1}^n X_{ij}Y_{ij}\]
\end{definition}
\begin{definition}[向量范数]
    $\norm{\cdot}$为范数需要满足以下三个条件
    \begin{enumerate}
        \item 齐次：$\norm{a\vx}=|a|\norm{\vx}$
        \item 正定：$\norm{\vx}\geq 0\iff \vx=\vzero$时取等
        \item 三角不等式：$\norm{\vx+\vy}\leq \norm{\vx}+\norm{\vy}$
    \end{enumerate}
\end{definition}
常见的向量范数如下，注意每个元素都要加\textbf{绝对值}
\begin{itemize}
\item 0-范数：非零元素数目，是伪范数（不符合第一个定义）
\item 1-范数：绝对值之和
\[\norm{\vx}_1=|x_1|+|x_2|+\cdots+|x_n|\]
\item 2-范数：欧几里得距离
\[\norm{\vx}_2=\sqrt{\sum_{i=1}^n |x_i|^2}\]
\item p-范数：p次方之和的p次根
\[\norm{\vx}_p=\sqrt[p]{\sum_{i=1}^n |x_i|^p}\]
\item 无穷范数(Chebyshev)：最大值
\[\norm{\vx}_\infty=\max\{|x_1|,\ldots,|x_n|\}\]
\end{itemize}
\begin{definition}[矩阵的范数]
    对于$n$阶方阵$A$，若对应非负实数$\norm{A}$，满足
    \begin{enumerate}
        \item $\norm{A}\geq 0$，当且仅当$A=\vzero$时等号成立
        \item 对任意$\alpha\in\rr$，$\norm{\alpha A}=|\alpha|\cdot\norm{A}$
        \item 对任意两个$n$阶方阵$A$和$\vB$，满足三角不等式$\norm{A+\vB}\leq\norm{A}+\norm{\vB}$
        \item 对任意两个$n$阶方阵$A$和$\vB$，满足矩阵乘法要求$\norm{A\vB}\leq\norm{A}\cdot\norm{\vB}$
    \end{enumerate}
    则称$\norm{A}$为方阵$A$的矩阵范数。
\end{definition}

记$\rho(A)=\max_{1\leq i\leq n}|\lambda_i|$为$A$的谱半径，这里$\lambda_i$为$A$的特征值，则常见的矩阵范数定义如下
\begin{itemize}
    \item 1-范数：绝对值之和
    \[\norm{A}_1=\max_{1\leq j\leq n}\sum_{i=1}^n|a_{ij}|\]
    \item 2-范数/谱范数：$A^\T A$的谱半径
    \[\norm{A}_2=\sqrt{\rho(A^\T A)}\]
    \item 无穷范数：最大值
    \[\norm{A}_\infty=\max_{1\leq i\leq n}\sum_{j=1}^n|a_{ij}|\]
    \item Frobenius(F-)范数：注意F-范数才是向量2-范数的直接推广
    \[\norm{X}_F=\lrp{\optr(X^T X)}^{1/2}=\lrp{\sum_{i=1}^m\sum_{j=1}^n X_{ij}^2}^{1/2}\]
\end{itemize}

\subsection{二次型}
\begin{definition}[二次型]
$Q(\vx)=\vx^\T A\vx$，其中$A$是对称矩阵\\
将二次型合并为矩阵的写法，平方项放对角线，交叉项取一半对称写. 以三元二次型为例，观察下面各个元素的去向.
\[\begin{aligned}Q(\vx)=\vx^\T A\vx&=\begin{bmatrix}x_1&x_2&x_3\end{bmatrix}\begin{bmatrix}a_{11}&a_{12}&a_{13}\\a_{21}&a_{22}&a_{23}\\a_{31}&a_{32}&a_{33}\end{bmatrix}\begin{bmatrix}x_1\\x_2\\x_3\end{bmatrix}\\
&=a_{11}x_1^2+a_{22}x_2^2+a_{33}x_3^2+(a_{12}+a_{21})x_1x_2+(a_{13}+a_{31})x_1x_3+(a_{23}+a_{32})x_2x_3\end{aligned}\]
\end{definition}
\begin{definition}[正定(positive definite)矩阵]
若矩阵$A$满足
\[\forall\;\vz\ne 0:\;\vz^\T A\vz>0\]
则称$A$为正定矩阵。
\end{definition}
\begin{definition}[合同(congruent)矩阵]
    若存在可逆矩阵$C$使得$C^\T AC=B$，则称$A$为$B$合同，记作$A\backsimeq B$
\end{definition}
\begin{definition}[主子式]
    从$n$阶矩阵中选取行号和列号相同的$i$列，行列交汇处的元素形成的行列式称为$n$阶矩阵的一个$i$阶主子式。如果挑选$1\thicksim i$行和$1\thicksim i$列，则成为该矩阵的$i$阶\textbf{顺序}主子式。
\end{definition}

正定矩阵$A$的等价命题如下
\begin{itemize}
    \item $A$的所有顺序主子式均为正
    \item $A$的所有主子式均为正
    \item $A$的特征值均为正
\end{itemize}

半正定矩阵的等价命题如下
\begin{itemize}
    \item $A$的所有主子式非负
    \item $A$的特征值均非负
    \item 有实矩阵$C$使$A=C^\T C$
\end{itemize}

\subsection{特征值分解}
\begin{definition}[谱分解/特征值分解]
假设$A\in\bbs^n$，则$A$可被分解为$A=Q\Lambda Q^T$，其中$Q\in\rr^{n\times n}$为正交矩阵，满足$Q^\T Q=I$，而$\Lambda=\opdiag(\lambda_1,\ldots,\lambda_n)$
\end{definition}

利用特征值可将行列式和迹表示成
\[\det A=\prod_{i=1}^n\lambda_i\qquad\optr A=\sum_{i=1}^n\lambda_i\]
而谱范数和F-范数同样可表示为
\[\norm{A}_2=\max_{i=1,\ldots,n}|\lambda_i|=\max\{\lambda_1,-\lambda_n\}\qquad\norm{A}_F=\lrp{\sum_{i=1}^n\lambda_i^2}^{1/2}\]

最大和最小特征值满足
\[\lambda_{\max}(A)=\sup_{\vx\ne\vzero}\frac{\vx^\T A\vx}{\vx^\T\vx}\qquad\lambda_{\min}(A)=\inf_{\vx\ne\vzero}\frac{\vx^\T A\vx}{\vx^\T\vx}\]
特别地，对于任意$\vx$，有
\[\lambda_{\min}(A)\vx^\T\vx\leq\vx^\T A\vx\leq\lambda_{\max}(A)\vx^\T\vx\]

令$A\in\bbs_+^n$的特征值分解为$A=Q\opdiag(\lambda_1,\ldots,\lambda_n)Q^\T$，则定义$A$的（对称）平方根为
\[A^{1/2}=Q\opdiag(\lambda_1^{1/2},\ldots,\lambda_n^{1/2})Q^\T\]
平方根$A^{1/2}$是矩阵方程$X^2=A$的唯一的对称半正定的解

\subsection{奇异值分解}
\begin{definition}[奇异值分解(SVD)]
    假设$A\in\rr^{m\times n},\oprank A=r$，那么$A$可被分解为$A=U\Sigma V^\T$，其中$U\in\rr^{m\times r}$，满足$U^\T U=I$，$V\in\rr^{n\times r}$满足$V^\T V=I$，而$\Sigma=\opdiag(\sigma_1,\ldots,\sigma_r)$满足
    \[\sigma_1\geq\sigma_2\geq\cdots\geq\sigma_r>0\]
    $U$的列向量被称为$A$的左奇异向量，$V$的列向量被称为右奇异向量，$\sigma_i$称为奇异值，进而奇异值分解可写成
    \[A=\sum_{i=1}^r\sigma_i u_i v_i^\T\]
    其中$u_i\in\rr^m$为左奇异向量，$v_i\in\rn$为右奇异向量
\end{definition}

最大最小奇异值可写为
\[\begin{aligned}
    \sigma_{\max}(A)&=\sup_{\vx,\vy\ne\vzero}\frac{\vx^\T A\vy}{\norm{\vx}_2\norm{\vy}_2}=\sup_{\vy\ne \vzero}\frac{\norm{A\vy}_2}{\norm{\vy}_2}\\
    \sigma_{\min}(A)&=\begin{cases}
        \sigma_r(A) & r=\min\{m,n\}\\
        0 & r=\min\{m,n\}
    \end{cases}
\end{aligned}\]

\begin{definition}[条件数]
非奇异矩阵的$A\in\rr^{n\times n}$的条件数定义为
\[\opcond(A)=\norm{A}_2\norm{A^{-1}}_2=\frac{\sigma_{\max}(A)}{\sigma_{\min}(A)}\]
\end{definition}

\section{矩阵微积分}
\label{appendix:matrix}
\subsection{基本定义}
\begin{definition}[可微]
    设$f:\rr^n\mapsto\rr^m$，若$f$在$\vx$处可微，则存在矩阵$Df(\vx)\in\rr^{m\times n}$满足
    \[\lim_{\vz\in\dom f,\vz\ne\vx,\vz\to\vx}\frac{\norm{f(\vz)-f(\vx)-Df(\vx)(\vz-\vx)}_2}{\norm{\vz-\vx}_2}=0\]
    则称$Df(\vx)$为$f$在$\vx$处的导数（或Jacobian矩阵，具有唯一性）。
    若$\dom f$为开集，且$f$在定义域内处处可微，则称为可微函数，并将$\vz$的仿射函数
    \[\hat{f}(\vx)=f(\vx)+Df(\vx)(\vz-\vx)\]
    称为$f$在$\vx$处的一次逼近\\
    通过推导可知
    \[Df(\vx)_{ij}=\pd{f_i(\vx)}{x_j},\;i=1,\ldots,m,\;j=1,\ldots,n\]
\end{definition}
\begin{definition}[梯度]
    对于实函数$f:\rm\mapsto\rr$，导数$Df(\vx)$是$1\times n$的矩阵，即行向量，它的转置称为函数的梯度$\nabla f(\vx)=Df(\vx)^\T$，为一个列向量，每一项是偏导数
    \[\nabla f(\vx)_i=\pd{f(\vx)}{x_i},\;i=1,\ldots,n\]
    一次逼近可改写为
    \[f(\vx)+\nabla^\T f(\vx)(\vz-\vx)\]
\end{definition}
\begin{theorem}[链式法则]
    设$f:\rn\mapsto\rr^m$在$\vx\in\opint\dom f$处可微，$g:\rr^m\mapsto\rr^p$在$f(\vx)\in\opint\dom g$处可微，定义复合函数为$h(\vz)=g(f(\vz))$，则$h$在$\vx$处可微，导数为
    \[Dh(\vx)=Dg(f(\vx))Df(\vx)\]
    注意是Jacobi矩阵才符合链式法则，不是梯度！
\end{theorem}
考虑复合仿射函数$g(\vx)=f(A\vx+\vb)$，由链式法则应该得到$Dg(\vx)=Df(A\vx+\vb)A$，当$f$为实函数时才有如下的梯度公式
\[\nabla g(\vx)=A^\T\nabla f(A\vx+\vb)\]

\begin{definition}[二阶导数]
    如果$f$在$\vx$处二阶可微，则$f$在$\vx\in\opint\dom f$处的二阶导数或Hessian矩阵为
    \[(\nabla^2 f(\vx))_{ij}=\pddxy{f(\vx)}{x_i}{x_j},\;i=1,\ldots,n,\;j=1,\ldots,n\]
    进而得到二阶逼近（也是Taylor展开）
    \[\hat{f}(\vx)=f(\vx)+\nabla f(\vx)^\T(\vz-\vx)+\frac{1}{2}(\vz-\vx)^\T\nabla^2 f(\vx)(\vz-\vx)\]
    满足
    \[\lim_{\vx\in\dom f,\vz\ne\vx,\vz\to\vx}\frac{|f(\vz)-\hat{f}(\vz)|}{\norm{\vz-\vx}_2^2}=0\]
    与雅可比矩阵的关系
    \[D\nabla f(\vx)=\nabla^2 f(\vx)\]
\end{definition}

\subsection{实值函数对向量的导数}
设$f(\vx):\rr^n\mapsto\rr$，劈形算子$\nabla$默认对$\vx$求导，可以得到以下公式。
\begin{enumerate}
\item $\nabla (\vv^\T\vx)=\vv$
\begin{analysis}
    展开，对每一个元素讨论
    \[\pd{\vv^\T\vx}{x_i}=\pd{\sum_{i=1}^n v_i x_i}{x_i}=v_i\]
\end{analysis}
\item $\nabla\norm{\vx}_2^2=\nabla(\vx^\T\vx)=2\vx$
\begin{analysis}
    法一：考虑每一元素
    \[\pd{\vx^\T\vx}{x_i}=\pd{\sum_{i=1}^n x_i^2}{x_i}=2x_i\]
    法二：变量多次出现的求导法则，下标$c$代表视为常数
    \[\nabla(\vx^\T\vx)=\nabla(\vx_c^\T\vx)+\nabla(\vx^\T\vx_c)=2\nabla(\vx_c^\T\vx)=2\vx_c=2\vx\]
\end{analysis}
\item $\nabla(\vx^\T A\vx)=(A+A^\T)\vx$
\begin{analysis}
    变量多次出现的求导法则
    \[\begin{aligned}
        LHS&=\nabla(\vx_c^\T A\vx)+\nabla(\vx^\T A\vx_c)\\
        &=\nabla((A^\T\vx_c)^\T\vx)+\nabla((A\vx_c)^\T \vx)\\
        &=A^\T\vx_c+A\vx_c\\
        &=RHS
    \end{aligned}\]
\end{analysis}
\item $\nabla\lrp{\frac{1}{2}\norm{A\vx-\vb}_2^2}=A^\T(A\vx-\vb)$
\begin{analysis}
    法一：展开括号，逐一求导
    \[\begin{aligned}
        LHS&=\frac{1}{2}(\nabla((A\vx-\vb)^\T(A\vx-\vb)))\\
        &=\frac{1}{2}(\nabla(\vx^\T A^\T A\vx)-\nabla(\vx^\T A^\T\vb)-\nabla(\vb^\T A\vx)+\nabla(\vb^\T\vb))\\
        &=\frac{1}{2}((A^\T A+(A^\T A)^T)\vx-A^\T\vb-A^\T\vb)\\
        &=A^\T(A\vx-\vb)\\
        &=RHS
    \end{aligned}\]
    法二：线性变换的求导公式
    \[\begin{aligned}
        LHS&=\frac{1}{2}A^\T\nabla_{A\vx-\vb}\norm{A\vx-\vb}_2^2\\
        &=A^\T(A\vx-\vb)\\
        &=RHS
    \end{aligned}\]
\end{analysis}
\end{enumerate}

\subsection{向量值函数对向量的导数}
设$\vf:\rn\mapsto\rr^m$，则劈形算子
\[\nabla_{\vx}\vf=\pd{\vf}{\vx}=\left[\pd{\vf}{\vx}\right]_{ij}=\left[\pd{f_i}{x_j}\right]\]
得到一个$m\times n$的矩阵，即为雅可比(Jacobi)矩阵
\begin{enumerate}
    \item $\nabla_\vx(A\vx)=A$
    \begin{analysis}
        基于此式，由乘法法则可以推出
        \[\begin{aligned}
            \nabla\vx^T\vx&=(\nabla \vx^\T)\vx+\vx^\T(\nabla \vx)\\
            &=(\nabla (I\vx)^\T)\vx+\vx^\T(\nabla I\vx)\\
            &=I\vx+\vx^\T I\\
            &=2\vx
        \end{aligned}\]
    \end{analysis}
    \item $\nabla^2 f=\nabla(\nabla f)$：Hessian矩阵
    \begin{analysis}
        Hessian矩阵其实是$\vx$到$\nabla f$的Jacobi矩阵
        \[(\nabla^2 f)_{ij}=\pddxy{f}{x_i}{x_j}=\pddxy{f}{\vx}{\vx^\T}=\pddxy{f}{\vx^\T}{\vx}\]
    \end{analysis}
\end{enumerate}

\section{参考资料}
\begin{enumerate}
    \item \emph{Convex optimization}, Stephen Boyd and Lieven Vandenberghe
    \item 凸优化（2018年秋季-北京大学），\url{http://bicmr.pku.edu.cn/~wenzw/opt-2018-fall.html}
    \item 机器学习中的矩阵/向量求导，\url{https://zhuanlan.zhihu.com/p/25063314}
    \item 矩阵求导术，\url{https://zhuanlan.zhihu.com/p/24709748}
    \item \emph{The Matrix Cookbook}, Kaare Brandt Petersen, Michael Syskind Pedersen
\end{enumerate}

% 作业：
% 2.1 2.2 2.5 2.7 2.10 2.16 2.18 2.19
% 3.1 3.2 3.5 3.13 3.18 3.21 3.33 3.36 3.43
% 4.3 4.9 4.22 4.24 4.29 4.62
% 5.5 5.20 5.27